# 概要
勤務表自動生成ツールです。
configに設定を入力し、プログラムを実行することで条件に合った勤務表を生成します。
アルゴリズムは焼きなまし法(Simulated Annealing法)を採用しています。

# 使い方
ファイル構成は以下の通りですが、メインの設定ファイルであるconfig/config以外は自由に配置することが可能です。
設定ファイル内では#を用いたコメントアウトが使えます。
また、改行やスペースの数は問題になりませんが、一行に書くべき情報を改行する場合はエラーとなります。

## メインconfig
呼び出すファイルを設定します。

### Files
勤務表のconfigを列挙します。

#### 例
```
--Files:
./config/configW.yaml
./config/configK.yaml
```

## 勤務表のconfig
勤務表に使う基本的な値の設定です。

### 職員リスト
職員の能力、公休数、夜勤数、遅番数、早番数、名前を列挙します。

#### 例
```
--職員リスト:
0 8 3 -1 -1 職員A
1 9 6  0  0 職員B
```

### NGリスト
特定の職員同士が夜勤で同じ日の勤務にならないようにするための設定です。
Workerのリストで上から1,2,3..と番号を振っていき、その番号で指定します。
行ごとに必ず改行を挟んで設定してください。

#### 例
```
--NGリスト:
1 2
6 2
```

### 職員数
職員の数を指定します。
職員リストの長さより小さい数が指定された場合、職員リストの上からその数だけカウントされ、余剰分は無視されます。

#### 例
```
--職員数:
12
```

### 日数
勤務表の日数を指定します。
30日の月で、バッファー日数を3日に指定している場合、30日+バッファー日数3日 = 33日として指定してください。

#### 例
```
--日数:
33
```

### DayST
日数で指定した日数分の日ごとのステータスを設定します。ステータスは以下の通りです。

- W: WeekDay 平日
- H: Holiday 休日
- F: Furo フロ
- 2: Furo2 フロ2
- G: Weight 体重測定

#### 例
```
--DayST:
W2WHHWFW2GHHWFW2WHHWFW2WHHWFW2WHH
```

### バッファー日数
バッファーの日数を指定します。
バッファーというのは、先月の終わり３日分など、考慮するべき日数です。
3日分を考慮する際は3を設定してください。

#### 例
```
--バッファー日数:
3
```

### 希望
希望として出された勤務表を指定します。
横軸が日、縦軸が職員です。
すなわち、行が職員ごとの希望、列が日ごとの希望となります。
ステータスは以下の通りです。

- N: 日勤
- K: 公休
- I: 夜勤入り
- A: 夜勤明け
- O: 遅番
- H: 早番
- Y: 有給
- U: 未定

希望を絶対として焼きなましを行います。
未定の場所以外は絶対条件としてカウントされ、出力で変化していることはありません。
また、未定(U)はスペース( )での入力も可能です。
バッファーが重要でない場合、Uとしても出力で変化することはありません。

#### 例
```
--希望:
AKNUUUUUUUUUUIAKYUUUUUUUUIAKUUUUU
KHIAKUUUUUUUUUUUIAKYUUUUUUUUUUUUU
OIAKUUUUUUUUUUUUUUUUUUUIAKYUUUUUU
NOKKUUUUUUUUUUUUUUUUUUUUUUUUUUUUY
IAKUUUUUUUUUUUUUUYUUUUUUUKUUUUUUU
HYNUUUUUUUUUUUUUKUUUUYUUUUUUUUUUU
KNOUUUUUUUUUUUUUUUUUUUYUUUUUUUUUU
KNIAIAKKIAKUUUUUUUUUUUUUUUUUUUYUU
KNHUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU
IAKUUUUUUUUUUUIAKUUUUUUUUUUUUUUUU
UUUKKUUUUYKKUUUUUKKUUUUUKKUUUUUKK
UUUKKUUUUUKKUUUUUKKKUUUKKKUUUUUKK
```

```
--希望:
   KKNNNNNKKNNNNNKKNNNNNKKNNNNNKK
NIAKKK    KKYK                   
AKN KK                           
NNIAK                        IAKY
KNN       KK                     
KNN                              
KNN                  YKK         
IAK               KK             
UUUKKYYYYYKYYYYYYKKYYYYYKYYYYYYKK
NKN      K                K      
NIAK                             
NNN             K   K     K      
NON    KK       KK               
ONK                              
AKO        K             K       
KNK                              
```

### 夜勤の人数リスト
職員ごとの１カ月の夜勤(入り)の日数を指定します。
値はスペースで区切ります。

#### 例
```
--夜勤の日数リスト:
3 6 6 6 6 6 6 6 3 6 0 0
```

### fillの関数
焼きなましの前に未定(U)の場所をうめるための関数を指定します。
以下の関数があります。

- fill1: それぞれの枠をランダムな要素で埋めます。
- fill2: 夜勤の数と公休の数を守り、入りと明けの連続やその後の休みも加味して埋めます。

#### 例
```
--fillの関数:
fill2
```

### fillのシード値
fillの乱数に用いるシード値を指定します。
型はusizeで、最小値は0、最大値はusizeの上限で、64bitなら18446744073709551615、32bitなら4294967295です。
0の場合、乱数に用いるシード値はランダムで選ばれます。
それ以外の場合固定です。
再現性のあるテストがしたいときは固定し、実際に使う場合は0が良いでしょう。

#### 例
```
--fillのシード値:
53
```

### アニーリング
焼きなましの設定ファイルのパスを指定します。
焼きなましはここで列挙した順に行われます。

#### 例
```
--アニーリング:
./config/anconfigW/randomWalk.yaml
./config/anconfigW/W1.yaml
./config/anconfigW/W2.yaml
```

### 結果のスコア
焼きなまし終了後、結果を表示する際に用いるスコアを列挙します。
スコアの名前と、そのスコアに用いるパラメータを指定します。
順不同です。スコアは以下のとおりです。


| Prop名               | 引数の型            | 説明                                                                                                                                                                                                                                   |
| :------------------- | :------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| IAKrenzoku           | f32                 | 入り、明け、休みの順番が取れていない場合のペナルティを指定します。                                                                                                                                                                     |
| KIArenzoku           | f32                 | 公休、入り、明けの順番になっている場合のペナルティを指定します。                                                                                                                                                                       |
| KNIArenzoku          | f32                 | 公休、日勤、入り、明けの順番になっている場合のペナルティを指定します。                                                                                                                                                                 |
| NNIArenzoku          | f32                 | 日勤、日勤、入り、明けの順番になっている場合の報酬を指定します。                                                                                                                                                                       |
| ONrenzoku            | f32                 | 遅番、日勤の順番になっている場合のペナルティを指定します。                                                                                                                                                                             |
| NHrenzoku            | f32                 | 日勤、早番の順番になっている場合のペナルティを指定します。                                                                                                                                                                             |
| OHrenzoku            | f32                 | 遅番、早番の順番になっている場合のペナルティを指定します。                                                                                                                                                                             |
| Renkin4              | (f32, f32)          | 4日連続勤務の場合のペナルティを指定します。                                                                                                                                                                                            |
| Renkin5              | (f32, f32)          | Renkin4同様、5日連続勤務の場合のペナルティを指定します。                                                                                                                                                                               |
| Renkin6              | (f32, f32)          | Renkin4同様、6日連続勤務の場合のペナルティを指定します。                                                                                                                                                                               |
| Renkyuu              | f32                 | 連休の場合の報酬を指定します。2日の連休ごとに発生します。                                                                                                                                                                              |
| Renkyuu2             | f32                 | 職員ごとに、一カ月の間に2連休がない場合のペナルティを指定します。                                                                                                                                                                      |
| Renkyuu2NoBf         | f32                 | Renkyuu2同様のスコアですが、バッファーを含みません。                                                                                                                                                                                   |
| OsoHayaBaransu       | f32                 | 職員ごとの、1か月の遅番と早番のバランスによるペナルティの倍率を指定します。                                                                                                                                                            |
| YakinBaransu         | f32                 | 夜勤の月の前半と後半でバランスが取れていない場合のペナルティの倍率を指定します。                                                                                                                                                       |
| OsoBaransu           | f32                 | 遅番の月の前半と後半でバランスが取れていない場合のペナルティの倍率を指定します。                                                                                                                                                       |
| HayaBaransu          | f32                 | 早番の月の前半と後半でバランスが取れていない場合のペナルティの倍率を指定します。                                                                                                                                                       |
| KokyuCount           | f32                 | 職員ごとの公休の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。                                                                                                                                     |
| YakinCount           | f32                 | 職員ごとの夜勤の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。                                                                                                                                     |
| OsoCount             | f32                 | 職員ごとの遅番の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。                                                                                                                                     |
| HayaCount            | f32                 | 職員ごとの早番の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。                                                                                                                                     |
| YakinNinzuu          | f32                 | 夜勤の人数がconfigファイルで設定した通りになっていない場合のペナルティを指定します。                                                                                                                                                   |
| NikkinNinzuu         | (DayST, isize, f32) | 曜日ごとの日勤の人数と、その通りになっていない場合のペナルティの倍率を指定します。引数は3つで、1つ目が曜日、2つ目が人数、3つ目が倍率です。曜日は平日(W)、休日(H)、フロ(F)、フロ2(2)、Weight(G)に対応します。                           |
| OsoNinzuu            | (isize, f32)        | 遅番の人数と、その通りになっていない場合のペナルティを指定します。                                                                                                                                                                     |
| HayaNinzuu           | (isize, f32)        | 早番の人数と、その通りになっていない場合のペナルティを指定します。                                                                                                                                                                     |
| NGPair               | f32                 | NGに指定されたペアが夜勤で同じ日になる場合のペナルティを指定します。                                                                                                                                                                   |
| Leader               | (isize, f32)        | リーダーとしての能力の番号と、祝日の日勤にリーダーがいない場合のペナルティを指定します。職員の能力を参照し、職員の能力がここで指定する番号で割り切れないならリーダーとします。                                                         |
| YakinAloneWorker     | (isize, f32)        | 一人で夜勤ができるワーカーの能力の番号と、ワーカーの夜勤が一人で、それが看護にワーカーの仕事を教えられる人でない場合のペナルティを指定します。職員の能力を参照し、職員の能力がここで指定する番号で割り切れないなら能力があるとします。 |
| YakinAloneBeforeFuro | f32                 | フロ日の前にワーカーの一人夜勤がある場合のペナルティを指定します。                                                                                                                                                                     |
| HeyaMoti             | (isize, isize, f32) | 部屋持ちができる能力の番号と、一日に必要な部屋持ちの人数と、部屋持ちの人数が十分でない場合のペナルティを指定します。                                                                                                                   |
| NoSamePair3          | f32                 | 夜勤で同じペアが3回以上ある場合のペナルティを指定します。                                                                                                                                                                              |
| NoSamePair2          | f32                 | 夜勤で同じペアが2回以上ある場合のペナルティを指定します。                                                                                                                                                                              |
| NoUndef              | f32                 | 未定(U)の枠があった場合のペナルティの倍率を指定します。                                                                                                                                                                                |


<!-- #### IAKrenzoku
入り、明け、休みの順番が取れていない場合のペナルティを指定します。引数は１つの実数です。

#### KIArenzoku
公休、入り、明けの順番になっている場合のペナルティを指定します。引数は１つの実数です。

#### KNIArenzoku
公休、日勤、入り、明けの順番になっている場合のペナルティを指定します。引数は１つの実数です。

#### NNIArenzoku
日勤、日勤、入り、明けの順番になっている場合の報酬を指定します。引数は１つの実数です。

#### ONrenzoku
遅番、日勤の順番になっている場合のペナルティを指定します。引数は１つの実数です。

#### NHrenzoku
日勤、早番の順番になっている場合のペナルティを指定します。引数は１つの実数です。

#### OHrenzoku
遅番、早番の順番になっている場合のペナルティを指定します。引数は１つの実数です。

#### Renkin4
4日連続勤務の場合のペナルティを指定します。引数は2つの実数で、第一引数は最後が入りの場合で、第二引数は最後が入り以外の場合です。

#### Renkin5
Renkin4同様、5日連続勤務の場合のペナルティを指定します。

#### Renkin6
Renkin4同様、6日連続勤務の場合のペナルティを指定します。

#### Renkyuu
連休の場合の報酬を指定します。2日の連休ごとに発生します。引数は1つの実数です。

#### Renkyuu2
職員ごとに、一カ月の間に2連休がない場合のペナルティを指定します。引数は1つの実数です。

#### Renkyuu2NoBf
Renkyuu2同様のスコアですが、バッファーを含みません。引数は1つの実数です。

#### OsoHayaBaransu
職員ごとの、1か月の遅番と早番のバランスによるペナルティの倍率を指定します。引数は1つの実数です。

#### YakinBaransu
夜勤の月の前半と後半でバランスが取れていない場合のペナルティの倍率を指定します。引数は1つの実数です。

#### OsoBaransu
遅番の月の前半と後半でバランスが取れていない場合のペナルティの倍率を指定します。引数は1つの実数です。

#### HayaBaransu
早番の月の前半と後半でバランスが取れていない場合のペナルティの倍率を指定します。引数は1つの実数です。

#### KokyuCount
職員ごとの公休の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。引数は1つの実数です。

#### YakinCount
職員ごとの夜勤の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。引数は1つの実数です。

#### OsoCount
職員ごとの遅番の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。引数は1つの実数です。

#### HayaCount
職員ごとの早番の数がconfigファイルで設定した通りになっていない場合のペナルティの倍率を指定します。引数は1つの実数です。

#### YakinNinzuu
夜勤の人数がconfigファイルで設定した通りになっていない場合のペナルティを指定します。引数は1つの実数です。

#### NikkinNinzuu
曜日ごとの日勤の人数と、その通りになっていない場合のペナルティの倍率を指定します。引数は3つで、1つ目が曜日、2つ目が人数、3つ目が倍率です。曜日は平日(W)、休日(H)、フロ(F)、フロ2(2)、Weight(G)に対応します。

#### OsoNinzuu
遅番の人数と、その通りになっていない場合のペナルティを指定します。引数は2つで、1つ目が整数、2つ目が実数です。

#### HayaNinzuu
早番の人数と、その通りになっていない場合のペナルティを指定します。引数は2つで、1つ目が整数、2つ目が実数です。

#### NGPair
NGに指定されたペアが夜勤で同じ日になる場合のペナルティを指定します。引数は1つの実数です。

#### Leader
リーダーとしての能力の番号と、祝日の日勤にリーダーがいない場合のペナルティを指定します。職員の能力を参照し、職員の能力がここで指定する番号で割り切れないならリーダーとします。引数は2つで、1つ目が整数、2つ目が実数です。

#### YakinAloneWorker
一人で夜勤ができるワーカーの能力の番号と、ワーカーの夜勤が一人で、それが看護にワーカーの仕事を教えられる人でない場合のペナルティを指定します。職員の能力を参照し、職員の能力がここで指定する番号で割り切れないなら能力があるとします。引数は2つで、1つ目が整数、2つ目が実数です。

#### YakinAloneBeforeFuro
フロ日の前にワーカーの一人夜勤がある場合のペナルティを指定します。引数は1つの実数です。

#### HeyaMoti
部屋持ちができる能力の番号と、一日に必要な部屋持ちの人数と、部屋持ちの人数が十分でない場合のペナルティを指定します。引数は3つで、1つ目と2つ目が整数、3つ目が実数です。

#### NoSamePair3
夜勤で同じペアが3回以上ある場合のペナルティを指定します。引数は1つの実数です。

#### NoSamePair2
夜勤で同じペアが2回以上ある場合のペナルティを指定します。引数は1つの実数です。

#### NoUndef
未定(U)の枠があった場合のペナルティの倍率を指定します。引数は1つの実数です。 -->

#### 例
```
--結果のスコア:
IAKrenzoku 1000
KIArenzoku 100
KNIArenzoku 10
NNIArenzoku 300
ONrenzoku 100
NHrenzoku 1000
OHrenzoku 2000
Renkin4 (1000,200)
Renkin5 (4000,1000)
Renkin6 (10000,4000)
NGPair 1000
Renkyuu 2
Renkyuu2 1000
Renkyuu2NoBf 1000
OsoHayaBaransu 3
YakinBaransu 10
OsoBaransu 3
HayaBaransu 3
KokyuCount 10
YakinCount 10
OsoCount 100
HayaCount 100
YakinNinzuu 10
NikkinNinzuu (F,4,5)
NikkinNinzuu (2,2,5)
NikkinNinzuu (W,2,5)
NikkinNinzuu (H,2,5)
NikkinNinzuu (G,2,5)
OsoNinzuu (1,100)
HayaNinzuu (1,100)
YakinAloneWorker (2,5000)
YakinAloneBeforeFuro 1000
NoUndef 10
NoSamePair3 1000
NoSamePair2 500
```

## 焼きなましのconfig
焼きなまし法で用いるパラメータを設定します。

### ステップ数
焼きなましのステップ数を指定します。

#### 例
```
--ステップ数:
20000
```

### 乱数のシード
焼きなまし法の更新関数に用いる乱数のシード値を指定します。
型はusizeで、最小値は0、最大値はusizeの上限で、64bitなら18446744073709551615、32bitなら4294967295です。
0の場合、乱数に用いるシード値はランダムで選ばれます。
それ以外の場合固定です。
再現性のあるテストがしたいときは固定し、実際に使う場合は0が良いでしょう。

```
--乱数のシード:
6554
```

### 各スコアのパラメータ
焼きなましに用いるスコアのパラメータを指定します。
順不同です。
パラメータは結果のスコアと同じです。


#### 例
```
--各スコアのパラメータ:
KIArenzoku 100
KNIArenzoku 10
NNIArenzoku 300
Renkin4 (1000,200)
Renkin5 (4000,1000)
Renkin6 (10000,4000)
Renkyuu2 1000
Renkyuu2NoBf 500
NGPair 1000
YakinBaransu 10
YakinNinzuu 100
NikkinNinzuu (F,6,4)
NikkinNinzuu (2,4,4)
NikkinNinzuu (W,4,4)
NikkinNinzuu (H,4,4)
NikkinNinzuu (G,4,4)
YakinAloneWorker (2,5000)
YakinAloneBeforeFuro 100
NoSamePair3 1000
NoSamePair2 500
```

### 更新関数
焼きなましの更新に用いる更新関数を指定します。
更新関数は以下の通りです。

- update4: N,O,HをN,O,Hのうちのランダムな要素に入れ替えます。
- update5: 夜勤と公休をランダムに移動します。夜勤の数や公休の数は維持されます。

#### 例
```
--更例関数:
update5
```

### maxTemp
焼きなましの最高温度を実数で指定します。
序盤に許容するスコアの悪化幅を指定するとよいでしょう。

#### 例
```
--maxTemp:
25
```

### minTemp
焼きなましの最低温度を実数で指定します。

#### 例
```
--minTemp:
0
```